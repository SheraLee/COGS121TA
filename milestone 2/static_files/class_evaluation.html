<!DOCTYPE html>
<html lang="en">
<head>
  <title>class_evaluation Page</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

 
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyC0afXrWzKDmxKFgnp4ltUxc7bG5p3gt8M",
    authDomain: "cogs121-cb16b.firebaseapp.com",
    databaseURL: "https://cogs121-cb16b.firebaseio.com",
    projectId: "cogs121-cb16b",
    storageBucket: "cogs121-cb16b.appspot.com",
    messagingSenderId: "727112788947",
    appId: "1:727112788947:web:06d5844aa7620e07"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
</script>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="jquery-3.3.1.min.js"></script>
  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="main_style.css">
  <script src="nav_bar.js"></script>  
  
  <script type="text/javascript">

$(document).ready(() => {
  const database = firebase.database();
  
  /*
  database.ref('students/Vincent').set({grade:'C', attendance:'85', gpa:'2.0'});
  database.ref('students/Yanyi').set({grade:'A', attendance:'90', gpa: '4.0'});
  database.ref('students/Shera').set({grade:'B', attendance:'40', gpa:'3.0'});
  */
  database.ref("students/").on('value', (snapshot) => {
      $('#gradeDiv').html('<h3>Students</h3>'+ "<table id='data' class='table table-responsive table-striped'><tr> <th>Student</th> <th>Grade</th> <th>Attendance</th></tr></table>")
      snapshot.forEach(function(data){
        
        $('#data').append("<tr> <td>"+data.key+"</td> <td>"+data.val().grade+"</td> <td>"+data.val().attendance+"</td> </tr>")
      });  
  });

  show_class_gpa();
  show_cape('COGS121');

  $("#prof_data").click( () =>{
  
    const course = $("#course_box").val();

    show_cape(course);
    /*  
    database.ref("cape_data").orderByChild('subject_course').equalTo(course).on('value', (snapshot) => {
      console.log(snapshot.val());
      $('#result').html('<h3 style="color:blue">'+ course +'</h3><br><div id="avg_stdy"></div>' + "<table id='data' class='table table-responsive table-striped'><tr> <th>Term</th> <th>Instructor</th> <th>Hours Study/Week</th> <th>Average GPA</th> </tr></table>")
      let avg_count = 0;
      let avg_study = 0;
      let avg_gpa = 0;

      snapshot.forEach(function(data){
        console.log(data.key);
        avg_count++;
        avg_study += parseInt(data.val().study_hours_per_week);
        
        if(data.val().avg_gpa_received != null){
          avg_gpa += parseInt(data.val().avg_gpa_received);
        }

        $('#data').append("<tr> <td>"+data.val().term+"</td> <td>"+data.val().instructor+"</td> <td>"+data.val().study_hours_per_week+"</td> <td>"+data.val().avg_gpa_received+"</td> </tr>")

      });
      $('#avg_stdy').append('<h5 style="color:green"> Average Study Hour/Week :' + (avg_study/avg_count).toFixed(2) +' Hrs</h5>');
      $('#avg_stdy').append('<h5 style="color:orange"> Average GPA :' + (avg_gpa/avg_count).toFixed(2) +'</h5>' + "(Undefined GPA counted as 0)");


    });
    */
  });

  $('#stu_edit').click( ()=>{
    const name = $('#stu_name').val();
    const grade = $('#stu_grade').val();
    const atd = $('#stu_atd').val();
    let gpa;

    switch(grade){
      case 'A':
        gpa = 4.0;
        break;
      case 'B':
        gpa = 3.0;
        break;
      case 'C':
        gpa = 2.0;
        break;
      case 'D':
        gpa = 1.0;
        break;
      default:
        gpa = 0;
        break;
    }

    database.ref('students/'+ name).set({
      grade: grade,
      attendance: atd,
      gpa:gpa
    });
  });

  function show_cape(cour){
    const course = cour;
    
    database.ref("cape_data").orderByChild('subject_course').equalTo(course).on('value', (snapshot) => {
      console.log(snapshot.val());
      $('#result').html('<h3 style="color:blue">'+ course +'</h3><br><div id="avg_stdy"></div>' + "<table id='data' class='table table-responsive table-striped'><tr> <th>Term</th> <th>Instructor</th> <th>Hours Study/Week</th> <th>Average GPA</th> </tr></table>")
      let avg_count = 0;
      let avg_study = 0;
      let avg_gpa = 0;

      snapshot.forEach(function(data){
        console.log(data.key);
        avg_count++;
        avg_study += parseInt(data.val().study_hours_per_week);
        
        if(data.val().avg_gpa_received != null){
          avg_gpa += parseInt(data.val().avg_gpa_received);
        }

        $('#data').append("<tr> <td>"+data.val().term+"</td> <td>"+data.val().instructor+"</td> <td>"+data.val().study_hours_per_week+"</td> <td>"+data.val().avg_gpa_received+"</td> </tr>")

      });
      $('#avg_stdy').append('<h5 style="color:green"> Average Study Hour/Week :' + (avg_study/avg_count).toFixed(2) +' Hrs</h5>');
      $('#avg_stdy').append('<h5 style="color:orange"> Average GPA :' + (avg_gpa/avg_count).toFixed(2) +'</h5>' + "(Undefined GPA counted as 0)");


    });
  }

  function show_class_gpa(){
    database.ref("students").orderByChild('gpa').on('value', (snapshot) => {
      console.log(snapshot.val());
      let avg_count = 0;
      let avg_gpa = 0;

      snapshot.forEach(function(data){
        
        avg_count++;
      
        if(data.val().gpa != null){
          avg_gpa += parseFloat(data.val().gpa);
        }

      });
      $('#class_gpa').html("Average GPA: "+ Number(avg_gpa/avg_count).toFixed(2)); 
     
    });
  }

  
   $('#allUsersButton').click( ()=> {
    database.ref("students/").once('value', (snapshot) => {
      $('#gradeDiv').html('<h3>Students</h3>'+ "<table id='data' class='table table-responsive table-striped'><tr> <th>Student</th> <th>Grade</th> <th>Attendance</th></tr></table>")
      snapshot.forEach(function(data){
        
        $('#data').append("<tr> <td>"+data.key+"</td> <td>"+data.val().grade+"</td> <td>"+data.val().attendance+"</td> </tr>")
      });
      
    });
  });

  $('#readButton').click( ()=> {
    const stu_name = 'students/' + $('#nameBox').val();
    database.ref(stu_name).once('value', (snapshot) => {
      $('#gradeDiv').html('<h3>Students</h3>'+ "<table id='data' class='table table-responsive table-striped'><tr> <th>Student</th> <th>Grade</th> <th>Attendance</th></tr></table>")
      $('#data').append("<tr> <td>"+snapshot.key+"</td> <td>"+snapshot.val().grade+"</td> <td>"+snapshot.val().attendance+"</td> </tr>")
    });
  });





// Load google charts
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);
google.charts.setOnLoadCallback(bar_grades);
google.charts.setOnLoadCallback(cape_hours("COGS121"));
google.charts.setOnLoadCallback(cape_gpa("COGS121"));

// Draw the chart and set the chart values
function drawChart() {
  
database.ref("side_comments").on("value", function(snapshot) {  
    var a = snapshot.numChildren(); // 1 ("name")

    var data = google.visualization.arrayToDataTable([
  ['Material', 'Questions Asked'],
  ['Lecture 1', a],
  ['Session 1', 3]
]);

  // Optional; add a title and set the width and height of the chart
  var options = {'title':'Number of Comments per Content', width:'400', height:'250'};

  // Display the chart inside the <div> element with id="piechart"
  var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
  chart.draw(data, options);


});
}

  function bar_grades() {
    
      database.ref("students").orderByChild('grade').on('value', (snapshot) => {
      console.log("grade =" + snapshot.val());
      let avg_count = 0;
      let avg_gpa = 0;
      let A=0, B=0, C=0, D=0, F=0;
      snapshot.forEach(function(data){
        
        console.log("data =" + data.val().grade);
        switch(data.val().grade){
          case 'A':
            A++;
            break;
          case 'B':
            B++;
            break;
          case 'C':
            C++;
            break;
          case 'D':
            D++;
            break;
          default:
            F++;
        break;
        }

        
        
        var data = google.visualization.arrayToDataTable([
        ["Grade", "Amount", { role: "style" } ],
        ["A", A, "color:#306bac"],
        ["B", B, "color:#306bac"],
        ["C", C, "color:#306bac"],
        ["D", D, "color:#306bac"],
        ["F", F, "color:#306bac"],
      ]);

      var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);
      

                       var options = {
        title: "Current Student Grades",
        width: 400,
        height: 400,
        bar: {groupWidth: "95%"},
        legend: { position: "none" },
      };
      var chart = new google.visualization.ColumnChart(document.getElementById("bar_grades"));
      chart.draw(view, options);
      });
    
     
    });

  }


  function cape_hours(course){
    
    database.ref("cape_data").orderByChild('subject_course').equalTo(course).once('value', (snapshot) => {
      console.log("grade =" + snapshot.val());
      
      let hour_data= [['Professor[Term]','Hours']]
      
    
      snapshot.forEach(function(data){
        let prof = data.val().instructor+'['+data.val().term+']';
        let hours = parseFloat(data.val().study_hours_per_week);
        const newHours = [prof,hours];
        hour_data.push(newHours);
        
      });
      console.log("HOurs = " + hour_data );
  
      var data = google.visualization.arrayToDataTable(hour_data);

      var options = {
        title: 'Hours spent studying',
        chartArea: {width: '50%'},
        hAxis: {
          title: 'Hours',
          minValue: 0
        },
        vAxis: {
          title: 'Professors [Term]'
        },
        width:'400', 
        height:'250'

      };

      var chart = new google.visualization.BarChart(document.getElementById('cape_hours'));

      chart.draw(data, options);
    });

  }

  function cape_gpa(course){
    
    database.ref("cape_data").orderByChild('subject_course').equalTo(course).once('value', (snapshot) => {
      console.log("grade =" + snapshot.val());
      
      let gpa_data= [['Professor[Term]','Gpa']]
      
    
      snapshot.forEach(function(data){
        let prof = data.val().instructor+'['+data.val().term+']';
        let gpa = parseFloat(data.val().avg_gpa_received);
        const newGpa = [prof,gpa];
        gpa_data.push(newGpa);
        
      });
      console.log("HOurs = " + gpa_data );
  
      var data = google.visualization.arrayToDataTable(gpa_data);

      var options = {
          title: 'Average GPA Received for this course (Based on CAPE data)',
          legend: { position: 'none' },
          width:'400', 
          height:'250'
        };

        var chart = new google.visualization.Histogram(document.getElementById('cape_gpa'));
        chart.draw(data, options);
    });

  }









});








    </script>
</head>

<body>
      
    <div id="mySidenav" class="sidenav open">
        <div style="display:block">
            <h2><a href="landing.html" style="padding:0">[Name of site]</a></h2>
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" style="margin:0px;padding:0px">&times;</a>
        </div>
        <a href="class_material.html">Class Material</a>
        <a href="session_active.html">Active Session</a>
        <a href="edit.html">Edit Sessions</a>
        <a href="class_evaluation.html">Class Statistics</a>
        <br>
       
        
        <!--<div style="bottom: 0;position: absolute;bottom: 0;padding-bottom: 50px;"> -->
        <a href="search_results.html">Find Classes</a>
        <a href="my_classes.html">My Classes</a>
        <!--</div>-->
      </div>
      
<div id="main">

    <div class="top_links">
        <p> <a href="class_page.html"> Class Page </a> > <span class="crumbs">Class Statistics</span></p>
        <ul>
             <!-- Use any element to open the sidenav -->
       <button id ="nav_btn" type="button" class="btn btn-default btn-sm nav_button" onclick="openNav()" style="float:left">
            <span class="material-icons">&#xe8ee;</span>
       </button>
            <h2>COGS 121 SP19 (UCSD)</h2>
        </ul>
    </div>

          <h1 class="main_header">Class Statistics</h1>

          <ul class="nav nav-pills" style="margin-bottom:10px">
              <li class="nav-item">
                <a class="nav-link active" data-toggle="pill" href="#class_stats">Class Info</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#student">Student Info</a>
              </li>
            </ul>


        <div class="tab-content">
        
      <!--
          <div id="class_stats" class="tab-pane active">
              <div class="row"  >
          
                  <div class="col-md-6">
                    Course: <input placeholder="Ex.COGS121" id="course_box" type="text" size="20"/>
                    <button id="prof_data">Get Course Data</button>
                            
                  </div>
              </div>  
              <div class="row" style="margin-top:20px">

                  <div class="card content_card col-md-6 stat_cards">
                      <div id="result"class="card-body">
                       
                      </div>
                  </div> 

                  <div class="card content_card col-md-6 stat_cards">
                      <h3>Your Class Data</h3>
                      <h5 style="color:blue">Current Class: COGS 121</h5>
                      <h5 style="color:green">AVG Hours Spent: 10.5 Hrs</h5>
                      <h5 style="color:orange">Current Class GPA: 3.0</h5>
                      <h5>Common Phrases: Easy Going, Helpful, Kind </h5>

                      <h5>Misc Data:</h5>
            
                      <div id="piechart"></div>
                  </div> 
          
      
                </div>     
          </div>
        -->

    
      <div id="class_stats" class="tab-pane active">
       <div class="container-fluid">
      <div class="card-columns">
        
        <div class="card content_card ">
          <div class="card-body text-center ">
            <h3>Your Average Class Statistics</h3>
            <h5 style="color:blue">Current Class: COGS 121</h5>
            <h5 style="color:green">Average Hours Spent: 10.5 Hrs</h5>
            <h5 style="color:orange"><span id="class_gpa"></span></h5>
          </div>
        </div>

        <div class="card content_card">
          <div class="card-body text-center container-fluid ">
            <h3>Number of Comments found in In class session and lecture matieral</h3>
            <div class="container-fluid" style="text-align:center" id="chart_wrap">
              <div id="chart_div" style="overflow: auto"></div>
            </div>
          </div>
        </div>

        <div class="card content_card ">
          <div class="card-body text-center ">
            <h3>Common Phrases Used to Describe Your Class</h3>
            <div class="infogram-embed" data-id="5fdb3e20-739a-42ea-9e12-a1ad28ef344d" data-type="interactive" data-title="Data From Class Eval."></div><script>!function(e,t,s,i){var n="InfogramEmbeds",o=e.getElementsByTagName("script")[0],d=/^http:/.test(e.location)?"http:":"https:";if(/^\/{2}/.test(i)&&(i=d+i),window[n]&&window[n].initialized)window[n].process&&window[n].process();else if(!e.getElementById(s)){var r=e.createElement("script");r.async=1,r.id=s,r.src=i,o.parentNode.insertBefore(r,o)}}(document,0,"infogram-async","https://e.infogram.com/js/dist/embed-loader-min.js");</script><div style="padding:8px 0;font-family:Arial!important;font-size:13px!important;line-height:15px!important;text-align:center;border-top:1px solid #dadada;margin:0 30px"><a href="https://infogram.com/5fdb3e20-739a-42ea-9e12-a1ad28ef344d" style="color:#989898!important;text-decoration:none!important;" target="_blank">Data From Class Eval.</a><br><a href="https://infogram.com" style="color:#989898!important;text-decoration:none!important;" target="_blank" rel="nofollow">Infogram</a></div>          </div>
        </div>
    


        <div class="card content_card">
          <div class="card-body text-center container-fluid ">
            <h3>Current Grade Distribution</h3>
            <div class="container-fluid" style="text-align:center">
              <div id="bar_grades" style="overflow: auto"></div>
            </div>
          </div>
        </div>


  

      </div>


      
        <div class="card-columns">
            <div class="card content_card">
              <div class="card-body text-center container-fluid ">
                <h3>Average Hours Spent Studying for this course (Based off CAPE data)</h3>
                <div class="container-fluid" style="text-align:center">
                  <div id="cape_gpa" style="overflow: auto"></div>
                </div>
              </div>
            </div>

            <div class="card content_card">
                <div class="card-body text-center container-fluid">
                  <h3>Average Hours Spent Studying for this course (Based off CAPE data)</h3>
                  <div class="container-fluid" style="text-align:center">
                    <div id="cape_hours" style="overflow: auto"></div>
                  </div>
                </div>
              </div>

          <div class="card content_card">
              <div class="card-body text-center">
                Course: <input placeholder="Ex.COGS121" id="course_box" type="text" size="20"/>
                <button id="prof_data">Get Course Data</button>
                
                <div id="result"class="card-body"></div>
              </div>
            </div>



        
      </div>


  
    </div> 


    </div>


        <div id="student" class="tab-pane fade in">
          <div>
            <h5>Display</h5>
            <input id="nameBox" type="text" size="20" placeholder="Enter Student Name"/>
            <button id="readButton">Get a Student's Performance</button>
            <button id="allUsersButton">Get all Student's Performance</button>
          </div>
          <br>
          <div>
            <h5>Edit Student Score</h5>
            <input id="stu_name" type="text" size="20" placeholder="Enter Student Name"/>
            <input id="stu_grade" type="text" size="20" placeholder="Enter Student Grade"/>
            <input id="stu_atd" type="text" size="20" placeholder="Enter Student Attendance"/>
            <button id="stu_edit">Change</button>
            
          </div>
          <br>
          <div id="gradeDiv"></div>
          <div id="attendanceDiv"></div> 

        </div>

      </div>

    </div>


</body>           