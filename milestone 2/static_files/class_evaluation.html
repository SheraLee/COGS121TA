<!DOCTYPE html>
<html lang="en">
<head>
  <title>class_evaluation Page</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

 
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyC0afXrWzKDmxKFgnp4ltUxc7bG5p3gt8M",
    authDomain: "cogs121-cb16b.firebaseapp.com",
    databaseURL: "https://cogs121-cb16b.firebaseio.com",
    projectId: "cogs121-cb16b",
    storageBucket: "cogs121-cb16b.appspot.com",
    messagingSenderId: "727112788947",
    appId: "1:727112788947:web:06d5844aa7620e07"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
</script>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="jquery-3.3.1.min.js"></script>
  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="main_style.css">
  <script src="nav_bar.js"></script>  
  
  <script type="text/javascript">

$(document).ready(() => {
  const database = firebase.database();
  database.ref('students/Vincent').set({grade:'A', attendance:'85'});
  database.ref('students/Yanyi').set({grade:'A', attendance:'90'});
  database.ref('students/Shera').set({grade:'C', attendance:'40'});

  $("#prof_data").click( () =>{
    const course = $("#course_box").val();
    
    database.ref("cape_data").orderByChild('subject_course').equalTo(course).on('value', (snapshot) => {
      console.log(snapshot.val());
      $('#result').html('<h3 style="color:blue">'+ course +'</h3><br><div id="avg_stdy"></div>' + "<table id='data' class='table table-responsive table-striped'><tr> <th>Term</th> <th>Instructor</th> <th>Hours Study/Week</th> <th>Average GPA</th> </tr></table>")
      let avg_count = 0;
      let avg_study = 0;
      let avg_gpa = 0;

      snapshot.forEach(function(data){
        console.log(data.key);
        avg_count++;
        avg_study += parseInt(data.val().study_hours_per_week);
        
        if(data.val().avg_gpa_received != null){
          avg_gpa += parseInt(data.val().avg_gpa_received);
        }

        $('#data').append("<tr> <td>"+data.val().term+"</td> <td>"+data.val().instructor+"</td> <td>"+data.val().study_hours_per_week+"</td> <td>"+data.val().avg_gpa_received+"</td> </tr>")

      });
      $('#avg_stdy').append('<h5 style="color:green"> Average Study Hour/Week :' + (avg_study/avg_count).toFixed(2) +' Hrs</h5>');
      $('#avg_stdy').append('<h5 style="color:orange"> Average GPA :' + (avg_gpa/avg_count).toFixed(2) +'</h5>' + "(Undefined GPA counted as 0)");


      //const data = snapshot.data;
      //$('#result').html("job:" + data.job);
    });
  });

 /*$('#resetButton').click(() => {
    console.log('Resetting the database');

    database.ref('cape_data').remove(); // delete the entire collection

  });
   */

  
   $('#allUsersButton').click( ()=> {
    database.ref("students/").once('value', (snapshot) => {
      $('#gradeDiv').html('<h3>Students</h3>'+ "<table id='data' class='table table-responsive table-striped'><tr> <th>Student</th> <th>Grade</th> <th>Attendance</th></tr></table>")
      snapshot.forEach(function(data){
        
        $('#data').append("<tr> <td>"+data.key+"</td> <td>"+data.val().grade+"</td> <td>"+data.val().attendance+"</td> </tr>")
      });
      
    });
  });

  $('#readButton').click( ()=> {
    const stu_name = 'students/' + $('#nameBox').val();
    database.ref(stu_name).once('value', (snapshot) => {
      $('#gradeDiv').html('<h3>Students</h3>'+ "<table id='data' class='table table-responsive table-striped'><tr> <th>Student</th> <th>Grade</th> <th>Attendance</th></tr></table>")
      $('#data').append("<tr> <td>"+snapshot.key+"</td> <td>"+snapshot.val().grade+"</td> <td>"+snapshot.val().attendance+"</td> </tr>")
    });
  });





// Load google charts
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

// Draw the chart and set the chart values
function drawChart() {
  
database.ref("side_comments").on("value", function(snapshot) {  
    var a = snapshot.numChildren(); // 1 ("name")

    var data = google.visualization.arrayToDataTable([
  ['Material', 'Questions Asked'],
  ['Lecture 1', a],
  ['Session 1', 3]
]);

  // Optional; add a title and set the width and height of the chart
  var options = {'title':'Number of Comments per Content', width:'450', height:'550'};

  // Display the chart inside the <div> element with id="piechart"
  var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
  chart.draw(data, options);


});
 
}


});








    </script>
</head>

<body>
      
    <div id="mySidenav" class="sidenav open">
        <div style="display:block">
            <h2>[Name of site]</h2>
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" style="margin:0px;padding:0px">&times;</a>
        </div>
        <a href="class_material.html">Class Material</a>
        <a href="session_active.html">Active Session</a>
        <a href="edit.html">Edit Sessions</a>
        <a href="class_evaluation.html">Class Statistics</a>
        <br>
       
        
        <!--<div style="bottom: 0;position: absolute;bottom: 0;padding-bottom: 50px;"> -->
        <a href="search_results.html">Find Classes</a>
        <a href="my_classes.html">My Classes</a>
        <!--</div>-->
      </div>
      
<div id="main">

    <div class="top_links">
        <p> <a href="class_page.html"> Class Page </a> > <span class="crumbs">Class Statistics</span></p>
        <ul>
             <!-- Use any element to open the sidenav -->
       <button id ="nav_btn" type="button" class="btn btn-default btn-sm nav_button" onclick="openNav()" style="float:left">
            <span class="material-icons">&#xe8ee;</span>
       </button>
            <h2>COGS 121 SP19 (UCSD)</h2>
        </ul>
    </div>

          <h1 class="main_header">Class Statistics</h1>

          <ul class="nav nav-pills" style="margin-bottom:10px">
              <li class="nav-item">
                <a class="nav-link active" data-toggle="pill" href="#class_stats">Class Info</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#student">Student Info</a>
              </li>
            </ul>


        <div class="tab-content">
        
      <!--
          <div id="class_stats" class="tab-pane active">
              <div class="row"  >
          
                  <div class="col-md-6">
                    Course: <input placeholder="Ex.COGS121" id="course_box" type="text" size="20"/>
                    <button id="prof_data">Get Course Data</button>
                            
                  </div>
              </div>  
              <div class="row" style="margin-top:20px">

                  <div class="card content_card col-md-6 stat_cards">
                      <div id="result"class="card-body">
                       
                      </div>
                  </div> 

                  <div class="card content_card col-md-6 stat_cards">
                      <h3>Your Class Data</h3>
                      <h5 style="color:blue">Current Class: COGS 121</h5>
                      <h5 style="color:green">AVG Hours Spent: 10.5 Hrs</h5>
                      <h5 style="color:orange">Current Class GPA: 3.0</h5>
                      <h5>Common Phrases: Easy Going, Helpful, Kind </h5>

                      <h5>Misc Data:</h5>
            
                      <div id="piechart"></div>
                  </div> 
          
      
                </div>     
          </div>
        -->

    
      <div id="class_stats" class="tab-pane active">
       <div class="container-fluid">
      <div class="card-columns">
        <div class="card content_card">
          <div class="card-body text-center">
            Course: <input placeholder="Ex.COGS121" id="course_box" type="text" size="20"/>
            <button id="prof_data">Get Course Data</button>
            
            <div id="result"class="card-body"></div>
          </div>
        </div>

        <div class="card content_card ">
          <div class="card-body text-center">
            <h3>Your Average Class Statistics</h3>
            <h5 style="color:blue">Current Class: COGS 121</h5>
            <h5 style="color:green">AVG Hours Spent: 10.5 Hrs</h5>
            <h5 style="color:orange">Current Class GPA: 3.0</h5>
          </div>
        </div>

        <div class="card content_card">
          <div class="card-body text-center container-fluid">
            <h3>Number of Comments found in In class session and lecture matieral</h3>
            <div class="container-fluid" style="text-align:center" id="chart_wrap">
              <div id="chart_div"></div>
            </div>
          </div>
        </div>

        <div class="card content_card ">
          <div class="card-body text-center">
            <h3>Common Phrases Used to Describe Your Class</h3>
            <div class="infogram-embed" data-id="5fdb3e20-739a-42ea-9e12-a1ad28ef344d" data-type="interactive" data-title="Data From Class Eval."></div><script>!function(e,t,s,i){var n="InfogramEmbeds",o=e.getElementsByTagName("script")[0],d=/^http:/.test(e.location)?"http:":"https:";if(/^\/{2}/.test(i)&&(i=d+i),window[n]&&window[n].initialized)window[n].process&&window[n].process();else if(!e.getElementById(s)){var r=e.createElement("script");r.async=1,r.id=s,r.src=i,o.parentNode.insertBefore(r,o)}}(document,0,"infogram-async","https://e.infogram.com/js/dist/embed-loader-min.js");</script><div style="padding:8px 0;font-family:Arial!important;font-size:13px!important;line-height:15px!important;text-align:center;border-top:1px solid #dadada;margin:0 30px"><a href="https://infogram.com/5fdb3e20-739a-42ea-9e12-a1ad28ef344d" style="color:#989898!important;text-decoration:none!important;" target="_blank">Data From Class Eval.</a><br><a href="https://infogram.com" style="color:#989898!important;text-decoration:none!important;" target="_blank" rel="nofollow">Infogram</a></div>          </div>
        </div>
    
      </div>


    

    </div> 





    </div>
















       

        <div id="student" class="tab-pane fade in">
            Name: <input id="nameBox" type="text" size="20"/>
            <button id="readButton">Get a Student's Performance</button>
            <button id="allUsersButton">Get all Student's Performance</button>
            <div id="gradeDiv"></div>
            <div id="attendanceDiv"></div> 
        </div>

      </div>

    </div>


</body>           